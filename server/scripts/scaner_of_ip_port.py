import socket

# Список часто используемых портов, которые могут быть подвержены уязвимостям
common_ports = {
    21: 'FTP',
    22: 'SSH',
    23: 'Telnet',
    25: 'SMTP',
    53: 'DNS',
    80: 'HTTP',
    110: 'POP3',
    135: 'RPC',
    139: 'NetBIOS',
    143: 'IMAP',
    443: 'HTTPS',
    445: 'SMB',
    3306: 'MySQL',
    3389: 'RDP'
}

def scan_port(ip, port, result_str):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(1)  # Установка тайм-аута
        result = sock.connect_ex((ip, port))
        if result == 0:
            status = f"Порт {port} ({common_ports[port]}) открыт\n"
        else:
            status = f"Порт {port} ({common_ports[port]}) закрыт\n"
        result_str.append(status)  # Добавляем строку в список
        sock.close()
    except Exception as e:
        error = f"Ошибка при сканировании порта {port}: {e}\n"
        result_str.append(error)

# Основная функция сканирования распространенных портов
def scan_common_ports(ip):
    print(f"Сканирование хоста {ip} на наличие открытых общих портов...")
    port_scan_result = []  # Список для хранения строк
    for port in common_ports:
        scan_port(ip, port, port_scan_result)

    # Объединяем строки в одну строку
    final_result = ''.join(port_scan_result)
    return final_result


# Этот код выполняет сканирование указанных IP-адресов на наличие открытых часто используемых портов.  

# ### Основные компоненты:
# 1. **Список портов**:
#    - `common_ports` содержит номера часто используемых портов и их назначение (например, HTTP, FTP).

# 2. **Функция `scan_port`**:
#    - Проверяет, открыт ли заданный порт на указанном IP-адресе.
#    - Использует метод `connect_ex`, который возвращает `0`, если соединение удалось (порт открыт), или ненулевое значение, если порт закрыт.
#    - Устанавливает тайм-аут в 1 секунду, чтобы не ждать слишком долго на недоступных портах.
#    - Выводит информацию об открытых или закрытых портах.

# 3. **Функция `scan_common_ports`**:
#    - Перебирает порты из `common_ports` и вызывает `scan_port` для каждого из них.
#    - Печатает процесс сканирования.

# ### Назначение:
# - Скрипт используется для проверки безопасности сети, чтобы определить, какие из распространенных портов открыты на заданном хосте.

# ### Использование:
# В текущем виде сканирование не запустится, так как ввод IP-адреса (`target_ip`) и вызов функции сканирования закомментированы. Для запуска нужно:
# 1. Раскомментировать ввод IP-адреса или задать его вручную.
# 2. Вызвать `scan_common_ports(target_ip)`.